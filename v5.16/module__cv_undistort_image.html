<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>Paparazzi UAS: cv_undistort_image module</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="penguin_icon.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Paparazzi UAS
   &#160;<span id="projectnumber">v5.15_devel-229-g3fb4ee4</span>
   </div>
   <div id="projectbrief">Paparazzi is a free software Unmanned Aircraft System.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('module__cv_undistort_image.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">cv_undistort_image module </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>Undistortion a fisheyelens distortion of a whole image</b></p>
<p>Note that this is quite a slow process, so it is not really advisable to use this in a vision pipeline leading to control. However, it can be used to find the right undistortion parameter k, and shows that the undistortion functions work.</p>
<p>The code also can be used to convert image coordinates from distorted fisheye lenses to undistorted coordinates and back. It takes into account the camera calibration matrix and the distortion of the specific lens.</p>
<h1><a class="anchor" id="module_load_example__cv_undistort_image"></a>
Example for airframe file</h1>
<p>Add to your firmware section: This example contains all possible configuration options, not all of them are mandatory! </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;module name=&quot;video_thread&quot;/&gt;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;module name=&quot;cv_undistort_image&quot;&gt;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;define name=&quot;UNDISTORT_MIN_X_NORMALIZED&quot; value=&quot;-2.0&quot; /&gt;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &lt;define name=&quot;UNDISTORT_MAX_X_NORMALIZED&quot; value=&quot;2.0&quot; /&gt;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &lt;define name=&quot;UNDISTORT_FPS&quot; value=&quot;0&quot; /&gt;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &lt;define name=&quot;UNDISTORT_CAMERA&quot; value=&quot;bottom_camera|front_camera&quot; /&gt;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  &lt;define name=&quot;UNDISTORT_CENTER_RATIO&quot; value=&quot;1.0&quot; /&gt;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;&lt;/module&gt;</div>
</div><!-- fragment --> <h1><a class="anchor" id="configuration__cv_undistort_image"></a>
Module configuration options</h1>
<h2><a class="anchor" id="define"></a>
Define Options</h2>
<ul>
<li><b>name:</b> <code>UNDISTORT_MIN_X_NORMALIZED</code> <b>value:</b> <em>-2.0</em> <br />
 Description: Minimal normalized x-coordinate to be used for the undistortion</li>
<li><b>name:</b> <code>UNDISTORT_MAX_X_NORMALIZED</code> <b>value:</b> <em>2.0</em> <br />
 Description: Maximal normalized x-coordinate to be used for the undistortion</li>
<li><b>name:</b> <code>UNDISTORT_FPS</code> <b>value:</b> <em>0</em> <br />
 Description: The (maximum) frequency to run the calculations at. If zero, it will max out at the camera frame rate</li>
<li><b>name:</b> <code>UNDISTORT_CAMERA</code> <b>value:</b> <em>bottom_camera|front_camera</em> <br />
 Description: The V4L2 camera device that is used for the calculations</li>
<li><b>name:</b> <code>UNDISTORT_CENTER_RATIO</code> <b>value:</b> <em>1.0</em> <br />
 Description: If smaller than 1 only generate pixels for the center_ratio times the min_x to max_x interval. This makes undistortion quicker, but for a smaller FOV.</li>
</ul>
<h1><a class="anchor" id="dependencies__cv_undistort_image"></a>
Dependencies</h1>
<ul>
<li><a class="el" href="module__video_thread.html">video_thread module</a> </li>
</ul>
<h1><a class="anchor" id="functions__cv_undistort_image"></a>
Module functions</h1>
<h2><a class="anchor" id="init_functions"></a>
Init Functions</h2>
<p>These initialization functions are called once on startup.</p>
<ul>
<li><a class="el" href="undistort__image_8c.html#a2fe19ff135bf0c4edca40d4f630b973f">undistort_image_init()</a></li>
</ul>
<h1><a class="anchor" id="files"></a>
Files</h1>
<h2><a class="anchor" id="headers"></a>
Header Files</h2>
<p>The following headers are automatically included in modules.h</p>
<ul>
<li><a class="el" href="undistort__image_8h.html">undistort_image.h</a></li>
</ul>
<h2><a class="anchor" id="sources"></a>
Source Files</h2>
<ul>
<li><a class="el" href="undistort__image_8c.html">modules/computer_vision/undistort_image.c</a></li>
<li><a class="el" href="image_8c.html">modules/computer_vision/lib/vision/image.c</a></li>
<li><a class="el" href="undistortion_8c.html">modules/computer_vision/lib/vision/undistortion.c</a></li>
</ul>
<h2><a class="anchor" id="module_xml__cv_undistort_image"></a>
Raw cv_undistort_image.xml file:</h2>
<div class="fragment"><div class="line">&lt;!DOCTYPE module SYSTEM &quot;module.dtd&quot;&gt;</div>
<div class="line"></div>
<div class="line">&lt;module name=&quot;cv_undistort_image&quot; dir=&quot;computer_vision&quot;&gt;</div>
<div class="line">  &lt;doc&gt;</div>
<div class="line">    &lt;description&gt;</div>
<div class="line">      Undistortion a fisheyelens distortion of a whole image. </div>
<div class="line">      Note that this is quite a slow process, so it is not really advisable to use this in a vision pipeline leading to control. </div>
<div class="line">      However, it can be used to find the right undistortion parameter k, and shows that the undistortion functions work.</div>
<div class="line"></div>
<div class="line">      The code also can be used to convert image coordinates from distorted fisheye lenses to undistorted coordinates and back.</div>
<div class="line">      It takes into account the camera calibration matrix and the distortion of the specific lens.</div>
<div class="line">    &lt;/description&gt;</div>
<div class="line">    &lt;define name=&quot;UNDISTORT_MIN_X_NORMALIZED&quot; value=&quot;-2.0&quot; description=&quot;Minimal normalized x-coordinate to be used for the undistortion&quot;/&gt;</div>
<div class="line">    &lt;define name=&quot;UNDISTORT_MAX_X_NORMALIZED&quot; value=&quot;2.0&quot; description=&quot;Maximal normalized x-coordinate to be used for the undistortion&quot;/&gt;</div>
<div class="line">    &lt;define name=&quot;UNDISTORT_FPS&quot; value=&quot;0&quot; description=&quot;The (maximum) frequency to run the calculations at. If zero, it will max out at the camera frame rate&quot;/&gt;</div>
<div class="line">    &lt;define name=&quot;UNDISTORT_CAMERA&quot; value=&quot;bottom_camera|front_camera&quot; description=&quot;The V4L2 camera device that is used for the calculations&quot;/&gt;</div>
<div class="line">    &lt;define name=&quot;UNDISTORT_CENTER_RATIO&quot; value=&quot;1.0&quot; description=&quot;If smaller than 1 only generate pixels for the center_ratio times the min_x to max_x interval. This makes undistortion quicker, but for a smaller FOV.&quot;/&gt;</div>
<div class="line">  &lt;/doc&gt;</div>
<div class="line"></div>
<div class="line">  &lt;settings&gt;</div>
<div class="line">    &lt;dl_settings&gt;</div>
<div class="line">      &lt;dl_settings NAME=&quot;Undistort&quot;&gt;</div>
<div class="line">  &lt;dl_setting var=&quot;min_x_normalized&quot;  min=&quot;-4.0&quot; step=&quot;0.1&quot; max=&quot;0.0&quot; shortname=&quot;min_x_n&quot; param=&quot;UNDISTORT_MIN_X_NORMALIZED&quot;/&gt;</div>
<div class="line">  &lt;dl_setting var=&quot;max_x_normalized&quot;  min=&quot;0.1&quot; step=&quot;0.1&quot; max=&quot;4.0&quot; shortname=&quot;max_x_n&quot; param=&quot;UNDISTORT_MAX_X_NORMALIZED&quot;/&gt;</div>
<div class="line">  &lt;dl_setting var=&quot;camera_intrinsics.Dhane_k&quot;  min=&quot;1.0&quot; step=&quot;0.01&quot; max=&quot;2.5&quot; shortname=&quot;dhane_k&quot; param=&quot;UNDISTORT_DHANE_K&quot;/&gt;</div>
<div class="line">  &lt;dl_setting var=&quot;center_ratio&quot;  min=&quot;0.05&quot; step=&quot;0.01&quot; max=&quot;1.0&quot; shortname=&quot;center_ratio&quot; param=&quot;UNDISTORT_CENTER_RATIO&quot;/&gt;</div>
<div class="line">  &lt;dl_setting var=&quot;camera_intrinsics.focal_x&quot;  min=&quot;0.0&quot; step=&quot;0.05&quot; max=&quot;1024.0&quot; shortname=&quot;focal_x&quot; param=&quot;UNDISTORT_FOCAL_X&quot;/&gt;</div>
<div class="line">  &lt;dl_setting var=&quot;camera_intrinsics.center_x&quot;  min=&quot;0.0&quot; step=&quot;0.05&quot; max=&quot;1024.0&quot; shortname=&quot;center_x&quot; param=&quot;UNDISTORT_CENTER_X&quot;/&gt;</div>
<div class="line">  &lt;dl_setting var=&quot;camera_intrinsics.focal_y&quot;  min=&quot;0.0&quot; step=&quot;0.05&quot; max=&quot;1024.0&quot; shortname=&quot;focal_y&quot; param=&quot;UNDISTORT_FOCAL_Y&quot;/&gt;</div>
<div class="line">  &lt;dl_setting var=&quot;camera_intrinsics.center_y&quot;  min=&quot;0.0&quot; step=&quot;0.05&quot; max=&quot;1024.0&quot; shortname=&quot;center_y&quot; param=&quot;UNDISTORT_CENTER_Y&quot;/&gt;</div>
<div class="line">      &lt;/dl_settings&gt;</div>
<div class="line">    &lt;/dl_settings&gt;</div>
<div class="line">  &lt;/settings&gt;</div>
<div class="line"></div>
<div class="line">  &lt;depends&gt;video_thread&lt;/depends&gt;</div>
<div class="line"></div>
<div class="line">  &lt;header&gt;</div>
<div class="line">    &lt;file name=&quot;undistort_image.h&quot;/&gt;</div>
<div class="line">  &lt;/header&gt;</div>
<div class="line"></div>
<div class="line">  &lt;init fun=&quot;undistort_image_init()&quot;/&gt;</div>
<div class="line">  &lt;makefile target=&quot;ap|nps&quot;&gt;</div>
<div class="line">    &lt;file name=&quot;undistort_image.c&quot;/&gt;</div>
<div class="line">    &lt;file name=&quot;image.c&quot; dir=&quot;modules/computer_vision/lib/vision&quot;/&gt;</div>
<div class="line">    &lt;file name=&quot;undistortion.c&quot; dir=&quot;modules/computer_vision/lib/vision&quot;/&gt;    </div>
<div class="line">  &lt;/makefile&gt;</div>
<div class="line">&lt;/module&gt;</div>
<div class="line"></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="onboard_modules.html">Onboard Modules</a></li>
    <li class="footer">Generated on Sat May 16 2020 16:06:49 for Paparazzi UAS by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.8 </li>
  </ul>
</div>
</body>
</html>
