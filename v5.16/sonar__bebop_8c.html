<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>Paparazzi UAS: sw/airborne/modules/sonar/sonar_bebop.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="penguin_icon.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Paparazzi UAS
   &#160;<span id="projectnumber">v5.15_devel-229-g3fb4ee4</span>
   </div>
   <div id="projectbrief">Paparazzi is a free software Unmanned Aircraft System.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('sonar__bebop_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">sonar_bebop.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Parrot Bebop Sonar driver.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="sonar__bebop_8h_source.html">sonar_bebop.h</a>&quot;</code><br />
<code>#include &quot;generated/airframe.h&quot;</code><br />
<code>#include &quot;<a class="el" href="adc_8h_source.html">mcu_periph/adc.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="spi_8h_source.html">mcu_periph/spi.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="sys__time_8h_source.html">mcu_periph/sys_time.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="abi_8h_source.html">subsystems/abi.h</a>&quot;</code><br />
<code>#include &lt;pthread.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &quot;<a class="el" href="downlink_8h_source.html">subsystems/datalink/downlink.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="median__filter_8h_source.html">filters/median_filter.h</a>&quot;</code><br />
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Include dependency graph for sonar_bebop.c:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="sonar__bebop_8c__incl.png" border="0" usemap="#sw_2airborne_2modules_2sonar_2sonar__bebop_8c" alt=""/></div>
<map name="sw_2airborne_2modules_2sonar_2sonar__bebop_8c" id="sw_2airborne_2modules_2sonar_2sonar__bebop_8c">
<area shape="rect" id="node2" href="sonar__bebop_8h.html" title="Parrot Bebop Sonar driver. " alt="" coords="1249,102,1366,129"/><area shape="rect" id="node5" href="adc_8h.html" title="arch independent ADC (Analog to Digital Converter) API " alt="" coords="1089,102,1225,129"/><area shape="rect" id="node8" href="spi_8h.html" title="Architecture independent SPI (Serial Peripheral Interface) API. " alt="" coords="865,102,995,129"/><area shape="rect" id="node10" href="sys__time_8h.html" title="Architecture independent timing functions. " alt="" coords="594,191,765,218"/><area shape="rect" id="node14" href="abi_8h.html" title="Main include for ABI (AirBorneInterface). " alt="" coords="1619,102,1753,129"/><area shape="rect" id="node18" href="downlink_8h.html" title="Common code for AP and FBW telemetry. " alt="" coords="1389,95,1543,136"/><area shape="rect" id="node28" href="median__filter_8h.html" title="filters/median_filter.h" alt="" coords="310,102,465,129"/><area shape="rect" id="node6" href="inttypes_8h.html" title="inttypes.h" alt="" coords="1031,281,1117,307"/><area shape="rect" id="node21" href="datalink_8h.html" title="Handling of messages coming from ground and other A/Cs. " alt="" coords="1379,184,1532,225"/><area shape="rect" id="node23" href="pprz__dl_8h.html" title="Datalink using PPRZ protocol. " alt="" coords="1556,191,1749,218"/><area shape="rect" id="node25" href="uart_8h.html" title="arch independent UART (Universal Asynchronous Receiver/Transmitter) API " alt="" coords="1559,281,1698,307"/><area shape="rect" id="node29" href="pprz__algebra__int_8h.html" title="Paparazzi fixed point algebra. " alt="" coords="298,191,477,218"/><area shape="rect" id="node30" href="pprz__algebra_8h.html" title="Paparazzi generic algebra macros. " alt="" coords="50,281,205,307"/><area shape="rect" id="node34" href="pprz__trig__int_8h.html" title="Paparazzi fixed point trig functions. " alt="" coords="331,281,481,307"/></map>
</div>
</div>
<p><a href="sonar__bebop_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:aa58c52ed6fb874f1db52977057a1242d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar__bebop_8c.html#aa58c52ed6fb874f1db52977057a1242d">SONAR_BEBOP_INX_DIFF_TO_DIST</a>&#160;&#160;&#160;340./(2.*160000.)</td></tr>
<tr class="memdesc:aa58c52ed6fb874f1db52977057a1242d"><td class="mdescLeft">&#160;</td><td class="mdescRight">SONAR_BEBOP_INX_DIFF_TO_DIST conversion from index difference to distance based on time of flight ADC speed = 160kHz speed of sound = 340m/s.  <a href="#aa58c52ed6fb874f1db52977057a1242d">More...</a><br /></td></tr>
<tr class="separator:aa58c52ed6fb874f1db52977057a1242d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c24ac701ff0a3680cdfc5dbc60bf57a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar__bebop_8c.html#a1c24ac701ff0a3680cdfc5dbc60bf57a">SONAR_BEBOP_ADC_MAX_VALUE</a>&#160;&#160;&#160;4095</td></tr>
<tr class="memdesc:a1c24ac701ff0a3680cdfc5dbc60bf57a"><td class="mdescLeft">&#160;</td><td class="mdescRight">SONAR_BEBOP_ADC_MAX_VALUE maximum ADC output (12 bit ADC)  <a href="#a1c24ac701ff0a3680cdfc5dbc60bf57a">More...</a><br /></td></tr>
<tr class="separator:a1c24ac701ff0a3680cdfc5dbc60bf57a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e8a10619b7218be47016114a501e943"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar__bebop_8c.html#a4e8a10619b7218be47016114a501e943">SONAR_BEBOP_ADC_BUFFER_SIZE</a>&#160;&#160;&#160;8192</td></tr>
<tr class="memdesc:a4e8a10619b7218be47016114a501e943"><td class="mdescLeft">&#160;</td><td class="mdescRight">SONAR_BEBOP_ADC_BUFFER_SIZE ADC buffer size.  <a href="#a4e8a10619b7218be47016114a501e943">More...</a><br /></td></tr>
<tr class="separator:a4e8a10619b7218be47016114a501e943"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5d4a93ccc6b9424f012526922b6344c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar__bebop_8c.html#ab5d4a93ccc6b9424f012526922b6344c">SONAR_BEBOP_TRANSITION_HIGH_TO_LOW</a>&#160;&#160;&#160;0.8</td></tr>
<tr class="memdesc:ab5d4a93ccc6b9424f012526922b6344c"><td class="mdescLeft">&#160;</td><td class="mdescRight">SONAR_BEBOP_TRANSITION_HIGH_TO_LOW below this altitude we should use mode 0.  <a href="#ab5d4a93ccc6b9424f012526922b6344c">More...</a><br /></td></tr>
<tr class="separator:ab5d4a93ccc6b9424f012526922b6344c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1a2721b9d1a8086bff14fb86548bc7c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar__bebop_8c.html#aa1a2721b9d1a8086bff14fb86548bc7c">SONAR_BEBOP_TRANSITION_LOW_TO_HIGH</a>&#160;&#160;&#160;1.2</td></tr>
<tr class="memdesc:aa1a2721b9d1a8086bff14fb86548bc7c"><td class="mdescLeft">&#160;</td><td class="mdescRight">SONAR_BEBOP_TRANSITION_LOW_TO_HIGH above this altitude we should use mode 1.  <a href="#aa1a2721b9d1a8086bff14fb86548bc7c">More...</a><br /></td></tr>
<tr class="separator:aa1a2721b9d1a8086bff14fb86548bc7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6017153886b228ceea828e5d7333a20b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar__bebop_8c.html#a6017153886b228ceea828e5d7333a20b">SONAR_BEBOP_TRANSITION_COUNT</a>&#160;&#160;&#160;7</td></tr>
<tr class="memdesc:a6017153886b228ceea828e5d7333a20b"><td class="mdescLeft">&#160;</td><td class="mdescRight">SONAR_BEBOP_TRANSITION_COUNT number of samples before switching mode.  <a href="#a6017153886b228ceea828e5d7333a20b">More...</a><br /></td></tr>
<tr class="separator:a6017153886b228ceea828e5d7333a20b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad38ba37e0445c0f57ef79e1c154ca7a3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar__bebop_8c.html#ad38ba37e0445c0f57ef79e1c154ca7a3">SONAR_BEBOP_PEAK_THRESHOLD</a>&#160;&#160;&#160;50</td></tr>
<tr class="memdesc:ad38ba37e0445c0f57ef79e1c154ca7a3"><td class="mdescLeft">&#160;</td><td class="mdescRight">SONAR_BEBOP_PEAK_THRESHOLD minimum samples from broadcast stop.  <a href="#ad38ba37e0445c0f57ef79e1c154ca7a3">More...</a><br /></td></tr>
<tr class="separator:ad38ba37e0445c0f57ef79e1c154ca7a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e6595e3723dd6cb79c4c5d658493c7e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar__bebop_8c.html#a5e6595e3723dd6cb79c4c5d658493c7e">SONAR_BEBOP_MIN_PEAK_VAL</a>&#160;&#160;&#160;512</td></tr>
<tr class="memdesc:a5e6595e3723dd6cb79c4c5d658493c7e"><td class="mdescLeft">&#160;</td><td class="mdescRight">SONAR_BEBOP_MIN_PEAK_VAL minimum adc value of reflected peak that will be cosidered.  <a href="#a5e6595e3723dd6cb79c4c5d658493c7e">More...</a><br /></td></tr>
<tr class="separator:a5e6595e3723dd6cb79c4c5d658493c7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ec0d211210689df81801b49607aef27"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar__bebop_8c.html#a8ec0d211210689df81801b49607aef27">SONAR_BEBOP_MAX_TRANS_TIME</a>&#160;&#160;&#160;370</td></tr>
<tr class="memdesc:a8ec0d211210689df81801b49607aef27"><td class="mdescLeft">&#160;</td><td class="mdescRight">SONAR_BEBOP_MAX_TRANS_TIME maximum time for a reflection to travel and return in the adc measurement window.  <a href="#a8ec0d211210689df81801b49607aef27">More...</a><br /></td></tr>
<tr class="separator:a8ec0d211210689df81801b49607aef27"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a523295c3c567273e2db300652a282f1f"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar__bebop_8c.html#a523295c3c567273e2db300652a282f1f">sonar_bebop_read</a> (void *data)</td></tr>
<tr class="memdesc:a523295c3c567273e2db300652a282f1f"><td class="mdescLeft">&#160;</td><td class="mdescRight">sonar_bebop_read Read ADC value to update sonar measurement  <a href="#a523295c3c567273e2db300652a282f1f">More...</a><br /></td></tr>
<tr class="separator:a523295c3c567273e2db300652a282f1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23dcc242803b0762d120696ddd57e98f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar__bebop_8c.html#a23dcc242803b0762d120696ddd57e98f">sonar_bebop_init</a> (void)</td></tr>
<tr class="separator:a23dcc242803b0762d120696ddd57e98f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:abd34fc7a6186364fcafd5199f924ee68"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="median__filter_8h.html#structMedianFilterFloat">MedianFilterFloat</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar__bebop_8c.html#abd34fc7a6186364fcafd5199f924ee68">sonar_filt</a></td></tr>
<tr class="separator:abd34fc7a6186364fcafd5199f924ee68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b68c7c64a460ae1cf5e4d479ee4bdbc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#a06896e8c53f721507066c079052171f8">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar__bebop_8c.html#a4b68c7c64a460ae1cf5e4d479ee4bdbc">sonar_bebop_spike_timer</a></td></tr>
<tr class="separator:a4b68c7c64a460ae1cf5e4d479ee4bdbc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37e90f5e3bd99fac2021fb3a326607d4"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar__bebop_8c.html#a37e90f5e3bd99fac2021fb3a326607d4">mode</a></td></tr>
<tr class="memdesc:a37e90f5e3bd99fac2021fb3a326607d4"><td class="mdescLeft">&#160;</td><td class="mdescRight">mode holds the current sonar mode mode = 0 used at high altitude, uses 16 wave patterns mode = 1 used at low altitude, uses 4 wave patterns  <a href="#a37e90f5e3bd99fac2021fb3a326607d4">More...</a><br /></td></tr>
<tr class="separator:a37e90f5e3bd99fac2021fb3a326607d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c27820b4b9e3b5a3fda0824ac2f52f8"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar__bebop_8c.html#a9c27820b4b9e3b5a3fda0824ac2f52f8">pulse_transition_counter</a></td></tr>
<tr class="separator:a9c27820b4b9e3b5a3fda0824ac2f52f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ccbb2cc5950621f61f55dae4d43ed67"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar__bebop_8c.html#a0ccbb2cc5950621f61f55dae4d43ed67">sonar_bebop_spi_d</a> [2][16]</td></tr>
<tr class="memdesc:a0ccbb2cc5950621f61f55dae4d43ed67"><td class="mdescLeft">&#160;</td><td class="mdescRight">sonar_bebop_spi_d the waveforms emitted by the sonar waveform 0 is long pulse used at high altitude waveform 1 is shorter pulse used at low altitude  <a href="#a0ccbb2cc5950621f61f55dae4d43ed67">More...</a><br /></td></tr>
<tr class="separator:a0ccbb2cc5950621f61f55dae4d43ed67"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae92b287267fb78103aead4947bceb2e7"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="sonar__bebop_8h.html#structSonarBebop">SonarBebop</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar__bebop_8c.html#ae92b287267fb78103aead4947bceb2e7">sonar_bebop</a></td></tr>
<tr class="separator:ae92b287267fb78103aead4947bceb2e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ba2b0245503312b971d86da22c40897"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="group__spi.html#structspi__transaction">spi_transaction</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar__bebop_8c.html#a7ba2b0245503312b971d86da22c40897">sonar_bebop_spi_t</a></td></tr>
<tr class="separator:a7ba2b0245503312b971d86da22c40897"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abdb18941dabfefeb513b80bc952ce9d5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sonar__bebop_8c.html#abdb18941dabfefeb513b80bc952ce9d5">adc_buffer</a> [<a class="el" href="sonar__bebop_8c.html#a4e8a10619b7218be47016114a501e943">SONAR_BEBOP_ADC_BUFFER_SIZE</a>]</td></tr>
<tr class="separator:abdb18941dabfefeb513b80bc952ce9d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Parrot Bebop Sonar driver. </p>
<p>This file contains the ADC driver for the sonar on the Parrot Bebop and Bebop 2 quadrotors. The sonar is both transmitter and receiver. An SPI interface is used to communicate with the 12 bit ADC which operates at 160kHz. The required waveform of the sonar is sent during the SPI transaction, with the returned data the recorded signal from the sonar. Two waveforms have been implemented dependent on the operating altitude of the Bebop. </p>

<p>Definition in file <a class="el" href="sonar__bebop_8c_source.html">sonar_bebop.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a4e8a10619b7218be47016114a501e943"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SONAR_BEBOP_ADC_BUFFER_SIZE&#160;&#160;&#160;8192</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>SONAR_BEBOP_ADC_BUFFER_SIZE ADC buffer size. </p>

<p>Definition at line <a class="el" href="sonar__bebop_8c_source.html#l00063">63</a> of file <a class="el" href="sonar__bebop_8c_source.html">sonar_bebop.c</a>.</p>

<p>Referenced by <a class="el" href="sonar__bebop_8c_source.html#l00150">sonar_bebop_read()</a>.</p>

</div>
</div>
<a class="anchor" id="a1c24ac701ff0a3680cdfc5dbc60bf57a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SONAR_BEBOP_ADC_MAX_VALUE&#160;&#160;&#160;4095</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>SONAR_BEBOP_ADC_MAX_VALUE maximum ADC output (12 bit ADC) </p>

<p>Definition at line <a class="el" href="sonar__bebop_8c_source.html#l00060">60</a> of file <a class="el" href="sonar__bebop_8c_source.html">sonar_bebop.c</a>.</p>

<p>Referenced by <a class="el" href="sonar__bebop_8c_source.html#l00150">sonar_bebop_read()</a>.</p>

</div>
</div>
<a class="anchor" id="aa58c52ed6fb874f1db52977057a1242d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SONAR_BEBOP_INX_DIFF_TO_DIST&#160;&#160;&#160;340./(2.*160000.)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>SONAR_BEBOP_INX_DIFF_TO_DIST conversion from index difference to distance based on time of flight ADC speed = 160kHz speed of sound = 340m/s. </p>

<p>Definition at line <a class="el" href="sonar__bebop_8c_source.html#l00057">57</a> of file <a class="el" href="sonar__bebop_8c_source.html">sonar_bebop.c</a>.</p>

<p>Referenced by <a class="el" href="sonar__bebop_8c_source.html#l00150">sonar_bebop_read()</a>.</p>

</div>
</div>
<a class="anchor" id="a8ec0d211210689df81801b49607aef27"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SONAR_BEBOP_MAX_TRANS_TIME&#160;&#160;&#160;370</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>SONAR_BEBOP_MAX_TRANS_TIME maximum time for a reflection to travel and return in the adc measurement window. </p>

<p>Definition at line <a class="el" href="sonar__bebop_8c_source.html#l00099">99</a> of file <a class="el" href="sonar__bebop_8c_source.html">sonar_bebop.c</a>.</p>

<p>Referenced by <a class="el" href="sonar__bebop_8c_source.html#l00150">sonar_bebop_read()</a>.</p>

</div>
</div>
<a class="anchor" id="a5e6595e3723dd6cb79c4c5d658493c7e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SONAR_BEBOP_MIN_PEAK_VAL&#160;&#160;&#160;512</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>SONAR_BEBOP_MIN_PEAK_VAL minimum adc value of reflected peak that will be cosidered. </p>

<p>Definition at line <a class="el" href="sonar__bebop_8c_source.html#l00095">95</a> of file <a class="el" href="sonar__bebop_8c_source.html">sonar_bebop.c</a>.</p>

<p>Referenced by <a class="el" href="sonar__bebop_8c_source.html#l00150">sonar_bebop_read()</a>.</p>

</div>
</div>
<a class="anchor" id="ad38ba37e0445c0f57ef79e1c154ca7a3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SONAR_BEBOP_PEAK_THRESHOLD&#160;&#160;&#160;50</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>SONAR_BEBOP_PEAK_THRESHOLD minimum samples from broadcast stop. </p>

<p>Definition at line <a class="el" href="sonar__bebop_8c_source.html#l00090">90</a> of file <a class="el" href="sonar__bebop_8c_source.html">sonar_bebop.c</a>.</p>

<p>Referenced by <a class="el" href="sonar__bebop_8c_source.html#l00150">sonar_bebop_read()</a>.</p>

</div>
</div>
<a class="anchor" id="a6017153886b228ceea828e5d7333a20b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SONAR_BEBOP_TRANSITION_COUNT&#160;&#160;&#160;7</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>SONAR_BEBOP_TRANSITION_COUNT number of samples before switching mode. </p>

<p>Definition at line <a class="el" href="sonar__bebop_8c_source.html#l00083">83</a> of file <a class="el" href="sonar__bebop_8c_source.html">sonar_bebop.c</a>.</p>

<p>Referenced by <a class="el" href="sonar__bebop_8c_source.html#l00150">sonar_bebop_read()</a>.</p>

</div>
</div>
<a class="anchor" id="ab5d4a93ccc6b9424f012526922b6344c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SONAR_BEBOP_TRANSITION_HIGH_TO_LOW&#160;&#160;&#160;0.8</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>SONAR_BEBOP_TRANSITION_HIGH_TO_LOW below this altitude we should use mode 0. </p>

<p>Definition at line <a class="el" href="sonar__bebop_8c_source.html#l00073">73</a> of file <a class="el" href="sonar__bebop_8c_source.html">sonar_bebop.c</a>.</p>

<p>Referenced by <a class="el" href="sonar__bebop_8c_source.html#l00150">sonar_bebop_read()</a>.</p>

</div>
</div>
<a class="anchor" id="aa1a2721b9d1a8086bff14fb86548bc7c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SONAR_BEBOP_TRANSITION_LOW_TO_HIGH&#160;&#160;&#160;1.2</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>SONAR_BEBOP_TRANSITION_LOW_TO_HIGH above this altitude we should use mode 1. </p>

<p>Definition at line <a class="el" href="sonar__bebop_8c_source.html#l00078">78</a> of file <a class="el" href="sonar__bebop_8c_source.html">sonar_bebop.c</a>.</p>

<p>Referenced by <a class="el" href="sonar__bebop_8c_source.html#l00150">sonar_bebop_read()</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a23dcc242803b0762d120696ddd57e98f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sonar_bebop_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="sonar__bebop_8c_source.html#l00115">115</a> of file <a class="el" href="sonar__bebop_8c_source.html">sonar_bebop.c</a>.</p>

<p>References <a class="el" href="spi_8h_source.html#l00157">spi_transaction::dss</a>, <a class="el" href="median__filter_8h_source.html#l00148">init_median_filter_f()</a>, <a class="el" href="spi_8h_source.html#l00149">spi_transaction::input_buf</a>, <a class="el" href="spi_8h_source.html#l00151">spi_transaction::input_length</a>, <a class="el" href="sonar__bebop_8h_source.html#l00033">SonarBebop::meas</a>, <a class="el" href="sonar__bebop_8c_source.html#l00069">mode</a>, <a class="el" href="sonar__bebop_8h_source.html#l00034">SonarBebop::offset</a>, <a class="el" href="spi_8h_source.html#l00150">spi_transaction::output_buf</a>, <a class="el" href="spi_8h_source.html#l00152">spi_transaction::output_length</a>, <a class="el" href="sonar__bebop_8c_source.html#l00086">pulse_transition_counter</a>, <a class="el" href="spi_8h_source.html#l00154">spi_transaction::select</a>, <a class="el" href="sonar__bebop_8c_source.html#l00107">sonar_bebop</a>, <a class="el" href="sonar__bebop_8c_source.html#l00150">sonar_bebop_read()</a>, <a class="el" href="sonar__bebop_8c_source.html#l00105">sonar_bebop_spi_d</a>, <a class="el" href="sonar__bebop_8c_source.html#l00109">sonar_bebop_spi_t</a>, <a class="el" href="sonar__bebop_8c_source.html#l00048">sonar_bebop_spike_timer</a>, <a class="el" href="sonar__bebop_8c_source.html#l00047">sonar_filt</a>, <a class="el" href="spi_8h_source.html#l00090">SPIDss8bit</a>, <a class="el" href="spi_8h_source.html#l00063">SPISelectUnselect</a>, <a class="el" href="spi_8h_source.html#l00101">SPITransDone</a>, <a class="el" href="spi_8h_source.html#l00162">spi_transaction::status</a>, and <a class="el" href="sys__time_8h_source.html#l00218">SysTimeTimerStart</a>.</p>

<p><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="sonar__bebop_8c_a23dcc242803b0762d120696ddd57e98f_cgraph.png" border="0" usemap="#sonar__bebop_8c_a23dcc242803b0762d120696ddd57e98f_cgraph" alt=""/></div>
<map name="sonar__bebop_8c_a23dcc242803b0762d120696ddd57e98f_cgraph" id="sonar__bebop_8c_a23dcc242803b0762d120696ddd57e98f_cgraph">
<area shape="rect" id="node2" href="median__filter_8h.html#a96f8e995febe47e892b65f0e6ea0bf3c" title="init_median_filter_f" alt="" coords="184,107,327,133"/><area shape="rect" id="node3" href="sonar__bebop_8c.html#a523295c3c567273e2db300652a282f1f" title="sonar_bebop_read Read ADC value to update sonar measurement " alt="" coords="185,157,326,184"/><area shape="rect" id="node4" href="linux_2mcu__periph_2adc__arch_8c.html#ab376b08d349863388fb0b17cb14c8caa" title="Start or stop the ADC readings. " alt="" coords="427,5,521,32"/><area shape="rect" id="node6" href="group__spi.html#ga5d383931766cb373ebad0b8bc26d439d" title="Submit SPI transaction. " alt="" coords="429,56,519,83"/><area shape="rect" id="node7" href="linux_2mcu__periph_2adc__arch_8c.html#a20ceeab2fc8a81cfb9ec2261a8b57234" title="Read the ADC buffer from the driver. " alt="" coords="433,107,515,133"/><area shape="rect" id="node8" href="median__filter_8h.html#a299781c28e551a49077251f79ddf6487" title="update_median_filter_f" alt="" coords="390,157,558,184"/><area shape="rect" id="node10" href="group__state__attitude.html#ga9a5e6bac6e7d78e1b33430e73344615b" title="Get vehicle body attitude euler angles (float). " alt="" coords="375,208,573,235"/><area shape="rect" id="node15" href="group__state__position.html#ga545d479db45e1a9711e59736b6d1309b" title="Get position in local ENU coordinates (float). " alt="" coords="393,259,555,285"/><area shape="rect" id="node27" href="chibios_2mcu__periph_2sys__time__arch_8c.html#a7ddfef1f78a56c6b4c4c536b5d670bfb" title="Get the time in microseconds since startup. " alt="" coords="402,309,546,336"/><area shape="rect" id="node5" href="linux_2mcu__periph_2adc__arch_8c.html#ad3e249549a50a2d6c16d1bb1ab3be7e9" title="Write an int to a sysfs file. " alt="" coords="647,5,762,32"/><area shape="rect" id="node9" href="median__filter_8h.html#ac22bc67043369c2e3322fbcbbe6b7b3f" title="get_median_filter_f" alt="" coords="633,157,777,184"/><area shape="rect" id="node11" href="group__math__orientation__representation.html#gaaae3838d0b45682d48257d5dbfff3030" title="Get vehicle body attitude euler angles (float). " alt="" coords="623,208,787,235"/><area shape="rect" id="node12" href="group__math__orientation__representation.html#ga8b8bf1c74adb971f399f0dd4f84d9388" title="orientationCalcEulers_f" alt="" coords="836,152,1004,179"/><area shape="rect" id="node13" href="group__math__algebra__float.html#gac568e7074d2732d1237f80898c1dfb76" title="float_eulers_of_rmat" alt="" coords="1052,101,1205,128"/><area shape="rect" id="node14" href="group__math__algebra__float.html#gacd48accfe6eaac320b0d651d894e1db8" title="euler rotation &#39;ZYX&#39; " alt="" coords="1053,152,1204,179"/><area shape="rect" id="node16" href="group__state__position.html#ga718066acd9581365ca5c2aacb29130fd" title="stateCalcPositionEnu_f" alt="" coords="621,340,788,367"/><area shape="rect" id="node17" href="pprz__geodetic__float_8c.html#a2a82ebdce90a3e41d54f72c5e787fcd0" title="enu_of_ecef_point_f" alt="" coords="1054,320,1203,347"/><area shape="rect" id="node18" href="group__math__geodetic__int.html#ga710a45725431766f0a003ba93cb58a11" title="Convert a ECEF position to local ENU. " alt="" coords="851,471,989,497"/><area shape="rect" id="node20" href="pprz__geodetic__float_8c.html#ab8d5cb7292ea74802e7a94e265c0703a" title="enu_of_lla_point_f" alt="" coords="852,365,988,392"/><area shape="rect" id="node22" href="group__math__geodetic__int.html#ga386f7bf340618bf1454ca2a3b5086100" title="Convert a LLA to ECEF. " alt="" coords="871,416,969,443"/><area shape="rect" id="node24" href="pprz__geodetic__float_8c.html#af99d4775df518f30b741b49c26eceedd" title="utm_of_lla_f" alt="" coords="871,261,969,288"/><area shape="rect" id="node19" href="group__math__geodetic__int.html#ga85bcbfc73a43b120465422ec55647573" title="Convert a point from ECEF to local ENU. " alt="" coords="1055,472,1203,499"/><area shape="rect" id="node21" href="pprz__geodetic__float_8c.html#a65bc5ba8b61d014ca659035759cc001c" title="ecef_of_lla_f" alt="" coords="1079,371,1179,397"/><area shape="rect" id="node23" href="group__math__geodetic__double.html#gae6608c48696daebf3382f08e655028d9" title="ecef_of_lla_d" alt="" coords="1077,421,1181,448"/><area shape="rect" id="node25" href="pprz__geodetic__float_8c.html#a25c5bd31de0ea0d0caf14a0d217ad3ea" title="isometric_latitude_f" alt="" coords="1055,203,1202,229"/><area shape="rect" id="node26" href="pprz__geodetic__float_8c.html#a21ea1b369f7d4abd984fb89c488dde24" title="isometric_latitude\l_fast_f" alt="" coords="1061,254,1197,295"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a523295c3c567273e2db300652a282f1f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void * sonar_bebop_read </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>sonar_bebop_read Read ADC value to update sonar measurement </p>

<p>Definition at line <a class="el" href="sonar__bebop_8c_source.html#l00150">150</a> of file <a class="el" href="sonar__bebop_8c_source.html">sonar_bebop.c</a>.</p>

<p>References <a class="el" href="sonar__bebop_8c_source.html#l00146">adc_buffer</a>, <a class="el" href="linux_2mcu__periph_2adc__arch_8c_source.html#l00101">adc_enable()</a>, <a class="el" href="linux_2mcu__periph_2adc__arch_8c_source.html#l00113">adc_read()</a>, <a class="el" href="abi__sender__ids_8h_source.html#l00129">AGL_SONAR_ADC_ID</a>, <a class="el" href="downlink_8h_source.html#l00042">DefaultChannel</a>, <a class="el" href="downlink_8h_source.html#l00046">DefaultDevice</a>, <a class="el" href="sonar__bebop_8h_source.html#l00035">SonarBebop::distance</a>, <a class="el" href="chibios_2mcu__periph_2sys__time__arch_8c_source.html#l00068">get_sys_time_usec()</a>, <a class="el" href="sonar__bebop_8h_source.html#l00033">SonarBebop::meas</a>, <a class="el" href="sonar__bebop_8c_source.html#l00069">mode</a>, <a class="el" href="spi_8h_source.html#l00150">spi_transaction::output_buf</a>, <a class="el" href="pprz__algebra__float_8h_source.html#l00085">FloatEulers::phi</a>, <a class="el" href="sonar__bebop_8c_source.html#l00086">pulse_transition_counter</a>, <a class="el" href="sonar__bebop_8c_source.html#l00107">sonar_bebop</a>, <a class="el" href="sonar__bebop_8c_source.html#l00063">SONAR_BEBOP_ADC_BUFFER_SIZE</a>, <a class="el" href="sonar__bebop_8c_source.html#l00060">SONAR_BEBOP_ADC_MAX_VALUE</a>, <a class="el" href="sonar__bebop_8c_source.html#l00057">SONAR_BEBOP_INX_DIFF_TO_DIST</a>, <a class="el" href="sonar__bebop_8c_source.html#l00099">SONAR_BEBOP_MAX_TRANS_TIME</a>, <a class="el" href="sonar__bebop_8c_source.html#l00095">SONAR_BEBOP_MIN_PEAK_VAL</a>, <a class="el" href="sonar__bebop_8c_source.html#l00090">SONAR_BEBOP_PEAK_THRESHOLD</a>, <a class="el" href="sonar__bebop_8c_source.html#l00105">sonar_bebop_spi_d</a>, <a class="el" href="sonar__bebop_8c_source.html#l00109">sonar_bebop_spi_t</a>, <a class="el" href="sonar__bebop_8c_source.html#l00083">SONAR_BEBOP_TRANSITION_COUNT</a>, <a class="el" href="sonar__bebop_8c_source.html#l00073">SONAR_BEBOP_TRANSITION_HIGH_TO_LOW</a>, <a class="el" href="sonar__bebop_8c_source.html#l00078">SONAR_BEBOP_TRANSITION_LOW_TO_HIGH</a>, <a class="el" href="sonar__bebop_8c_source.html#l00047">sonar_filt</a>, <a class="el" href="spi_8c_source.html#l00035">spi0</a>, <a class="el" href="chibios_2mcu__periph_2spi__arch_8c_source.html#l00511">spi_submit()</a>, <a class="el" href="spi_8h_source.html#l00101">SPITransDone</a>, <a class="el" href="spi_8h_source.html#l00099">SPITransSuccess</a>, <a class="el" href="state_8h_source.html#l01143">stateGetNedToBodyEulers_f()</a>, <a class="el" href="state_8h_source.html#l00719">stateGetPositionEnu_f()</a>, <a class="el" href="spi_8h_source.html#l00162">spi_transaction::status</a>, <a class="el" href="pprz__algebra__float_8h_source.html#l00086">FloatEulers::theta</a>, <a class="el" href="median__filter_8h_source.html#l00175">update_median_filter_f()</a>, and <a class="el" href="pprz__geodetic__float_8h_source.html#l00075">EnuCoor_f::z</a>.</p>

<p>Referenced by <a class="el" href="sonar__bebop_8c_source.html#l00115">sonar_bebop_init()</a>.</p>

<p><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="sonar__bebop_8c_a523295c3c567273e2db300652a282f1f_cgraph.png" border="0" usemap="#sonar__bebop_8c_a523295c3c567273e2db300652a282f1f_cgraph" alt=""/></div>
<map name="sonar__bebop_8c_a523295c3c567273e2db300652a282f1f_cgraph" id="sonar__bebop_8c_a523295c3c567273e2db300652a282f1f_cgraph">
<area shape="rect" id="node2" href="linux_2mcu__periph_2adc__arch_8c.html#ab376b08d349863388fb0b17cb14c8caa" title="Start or stop the ADC readings. " alt="" coords="247,5,341,32"/><area shape="rect" id="node4" href="linux_2mcu__periph_2adc__arch_8c.html#a20ceeab2fc8a81cfb9ec2261a8b57234" title="Read the ADC buffer from the driver. " alt="" coords="253,56,335,83"/><area shape="rect" id="node5" href="chibios_2mcu__periph_2sys__time__arch_8c.html#a7ddfef1f78a56c6b4c4c536b5d670bfb" title="Get the time in microseconds since startup. " alt="" coords="222,107,366,133"/><area shape="rect" id="node6" href="group__spi.html#ga5d383931766cb373ebad0b8bc26d439d" title="Submit SPI transaction. " alt="" coords="249,157,339,184"/><area shape="rect" id="node7" href="group__state__attitude.html#ga9a5e6bac6e7d78e1b33430e73344615b" title="Get vehicle body attitude euler angles (float). " alt="" coords="195,208,393,235"/><area shape="rect" id="node12" href="group__state__position.html#ga545d479db45e1a9711e59736b6d1309b" title="Get position in local ENU coordinates (float). " alt="" coords="213,259,375,285"/><area shape="rect" id="node24" href="median__filter_8h.html#a299781c28e551a49077251f79ddf6487" title="update_median_filter_f" alt="" coords="210,309,378,336"/><area shape="rect" id="node3" href="linux_2mcu__periph_2adc__arch_8c.html#ad3e249549a50a2d6c16d1bb1ab3be7e9" title="Write an int to a sysfs file. " alt="" coords="467,5,582,32"/><area shape="rect" id="node8" href="group__math__orientation__representation.html#gaaae3838d0b45682d48257d5dbfff3030" title="Get vehicle body attitude euler angles (float). " alt="" coords="443,132,607,159"/><area shape="rect" id="node9" href="group__math__orientation__representation.html#ga8b8bf1c74adb971f399f0dd4f84d9388" title="orientationCalcEulers_f" alt="" coords="656,69,824,96"/><area shape="rect" id="node10" href="group__math__algebra__float.html#gac568e7074d2732d1237f80898c1dfb76" title="float_eulers_of_rmat" alt="" coords="872,19,1025,45"/><area shape="rect" id="node11" href="group__math__algebra__float.html#gacd48accfe6eaac320b0d651d894e1db8" title="euler rotation &#39;ZYX&#39; " alt="" coords="873,69,1024,96"/><area shape="rect" id="node13" href="group__state__position.html#ga718066acd9581365ca5c2aacb29130fd" title="stateCalcPositionEnu_f" alt="" coords="441,259,608,285"/><area shape="rect" id="node14" href="pprz__geodetic__float_8c.html#a2a82ebdce90a3e41d54f72c5e787fcd0" title="enu_of_ecef_point_f" alt="" coords="874,237,1023,264"/><area shape="rect" id="node15" href="group__math__geodetic__int.html#ga710a45725431766f0a003ba93cb58a11" title="Convert a ECEF position to local ENU. " alt="" coords="671,385,809,412"/><area shape="rect" id="node17" href="pprz__geodetic__float_8c.html#ab8d5cb7292ea74802e7a94e265c0703a" title="enu_of_lla_point_f" alt="" coords="672,284,808,311"/><area shape="rect" id="node19" href="group__math__geodetic__int.html#ga386f7bf340618bf1454ca2a3b5086100" title="Convert a LLA to ECEF. " alt="" coords="691,335,789,361"/><area shape="rect" id="node21" href="pprz__geodetic__float_8c.html#af99d4775df518f30b741b49c26eceedd" title="utm_of_lla_f" alt="" coords="691,179,789,205"/><area shape="rect" id="node16" href="group__math__geodetic__int.html#ga85bcbfc73a43b120465422ec55647573" title="Convert a point from ECEF to local ENU. " alt="" coords="875,389,1023,416"/><area shape="rect" id="node18" href="pprz__geodetic__float_8c.html#a65bc5ba8b61d014ca659035759cc001c" title="ecef_of_lla_f" alt="" coords="899,288,999,315"/><area shape="rect" id="node20" href="group__math__geodetic__double.html#gae6608c48696daebf3382f08e655028d9" title="ecef_of_lla_d" alt="" coords="897,339,1001,365"/><area shape="rect" id="node22" href="pprz__geodetic__float_8c.html#a25c5bd31de0ea0d0caf14a0d217ad3ea" title="isometric_latitude_f" alt="" coords="875,120,1022,147"/><area shape="rect" id="node23" href="pprz__geodetic__float_8c.html#a21ea1b369f7d4abd984fb89c488dde24" title="isometric_latitude\l_fast_f" alt="" coords="881,171,1017,213"/><area shape="rect" id="node25" href="median__filter_8h.html#ac22bc67043369c2e3322fbcbbe6b7b3f" title="get_median_filter_f" alt="" coords="453,309,597,336"/></map>
</div>
</p>

<p><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="sonar__bebop_8c_a523295c3c567273e2db300652a282f1f_icgraph.png" border="0" usemap="#sonar__bebop_8c_a523295c3c567273e2db300652a282f1f_icgraph" alt=""/></div>
<map name="sonar__bebop_8c_a523295c3c567273e2db300652a282f1f_icgraph" id="sonar__bebop_8c_a523295c3c567273e2db300652a282f1f_icgraph">
<area shape="rect" id="node2" href="sonar__bebop_8h.html#a23dcc242803b0762d120696ddd57e98f" title="sonar_bebop_init" alt="" coords="195,5,325,32"/></map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="abdb18941dabfefeb513b80bc952ce9d5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a> adc_buffer[<a class="el" href="sonar__bebop_8c.html#a4e8a10619b7218be47016114a501e943">SONAR_BEBOP_ADC_BUFFER_SIZE</a>]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="sonar__bebop_8c_source.html#l00146">146</a> of file <a class="el" href="sonar__bebop_8c_source.html">sonar_bebop.c</a>.</p>

<p>Referenced by <a class="el" href="sonar__bebop_8c_source.html#l00150">sonar_bebop_read()</a>.</p>

</div>
</div>
<a class="anchor" id="a37e90f5e3bd99fac2021fb3a326607d4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> mode</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>mode holds the current sonar mode mode = 0 used at high altitude, uses 16 wave patterns mode = 1 used at low altitude, uses 4 wave patterns </p>

<p>Definition at line <a class="el" href="sonar__bebop_8c_source.html#l00069">69</a> of file <a class="el" href="sonar__bebop_8c_source.html">sonar_bebop.c</a>.</p>

<p>Referenced by <a class="el" href="sim__i2c__cam__ctrl_8c_source.html#l00054">atmega_i2c_cam_ctrl_send()</a>, <a class="el" href="dc_8c_source.html#l00163">dc_info()</a>, <a class="el" href="lis3mdl_8c_source.html#l00060">lis3mdl_init()</a>, <a class="el" href="mavlink_8c_source.html#l00222">mavlink_common_message_handler()</a>, <a class="el" href="throttle__curve_8c_source.html#l00208">nav_throttle_curve_set()</a>, <a class="el" href="subsystems_2radio__control_2rc__datalink_8c_source.html#l00040">parse_rc_3ch_datalink()</a>, <a class="el" href="formation_8h_source.html#l00056">parseFormationSlot()</a>, <a class="el" href="telemetry_8c_source.html#l00078">periodic_telemetry_err_report()</a>, <a class="el" href="rotorcraft__cam_8c_source.html#l00097">rotorcraft_cam_set_mode()</a>, <a class="el" href="sdio__arch_8c_source.html#l00048">sdio_connect()</a>, <a class="el" href="sonar__bebop_8c_source.html#l00115">sonar_bebop_init()</a>, <a class="el" href="sonar__bebop_8c_source.html#l00150">sonar_bebop_read()</a>, <a class="el" href="throttle__curve_8c_source.html#l00115">throttle_curve_run()</a>, and <a class="el" href="stm32_2mcu__periph_2uart__arch_8c_source.html#l00092">uart_periph_set_mode()</a>.</p>

</div>
</div>
<a class="anchor" id="a9c27820b4b9e3b5a3fda0824ac2f52f8"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> pulse_transition_counter</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="sonar__bebop_8c_source.html#l00086">86</a> of file <a class="el" href="sonar__bebop_8c_source.html">sonar_bebop.c</a>.</p>

<p>Referenced by <a class="el" href="sonar__bebop_8c_source.html#l00115">sonar_bebop_init()</a>, and <a class="el" href="sonar__bebop_8c_source.html#l00150">sonar_bebop_read()</a>.</p>

</div>
</div>
<a class="anchor" id="ae92b287267fb78103aead4947bceb2e7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="sonar__bebop_8h.html#structSonarBebop">SonarBebop</a> sonar_bebop</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="sonar__bebop_8c_source.html#l00107">107</a> of file <a class="el" href="sonar__bebop_8c_source.html">sonar_bebop.c</a>.</p>

<p>Referenced by <a class="el" href="sonar__bebop_8c_source.html#l00115">sonar_bebop_init()</a>, and <a class="el" href="sonar__bebop_8c_source.html#l00150">sonar_bebop_read()</a>.</p>

</div>
</div>
<a class="anchor" id="a0ccbb2cc5950621f61f55dae4d43ed67"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> sonar_bebop_spi_d[2][16]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {{ 0xF0, 0xF0, 0xF0, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },</div>
<div class="line">                                           { 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0x00, 0x00, 0x00, 0x00 }}</div>
</div><!-- fragment -->
<p>sonar_bebop_spi_d the waveforms emitted by the sonar waveform 0 is long pulse used at high altitude waveform 1 is shorter pulse used at low altitude </p>

<p>Definition at line <a class="el" href="sonar__bebop_8c_source.html#l00105">105</a> of file <a class="el" href="sonar__bebop_8c_source.html">sonar_bebop.c</a>.</p>

<p>Referenced by <a class="el" href="sonar__bebop_8c_source.html#l00115">sonar_bebop_init()</a>, and <a class="el" href="sonar__bebop_8c_source.html#l00150">sonar_bebop_read()</a>.</p>

</div>
</div>
<a class="anchor" id="a7ba2b0245503312b971d86da22c40897"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="group__spi.html#structspi__transaction">spi_transaction</a> sonar_bebop_spi_t</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="sonar__bebop_8c_source.html#l00109">109</a> of file <a class="el" href="sonar__bebop_8c_source.html">sonar_bebop.c</a>.</p>

<p>Referenced by <a class="el" href="sonar__bebop_8c_source.html#l00115">sonar_bebop_init()</a>, and <a class="el" href="sonar__bebop_8c_source.html#l00150">sonar_bebop_read()</a>.</p>

</div>
</div>
<a class="anchor" id="a4b68c7c64a460ae1cf5e4d479ee4bdbc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#a06896e8c53f721507066c079052171f8">uint32_t</a> sonar_bebop_spike_timer</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="sonar__bebop_8c_source.html#l00048">48</a> of file <a class="el" href="sonar__bebop_8c_source.html">sonar_bebop.c</a>.</p>

<p>Referenced by <a class="el" href="sonar__bebop_8c_source.html#l00115">sonar_bebop_init()</a>.</p>

</div>
</div>
<a class="anchor" id="abd34fc7a6186364fcafd5199f924ee68"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="median__filter_8h.html#structMedianFilterFloat">MedianFilterFloat</a> sonar_filt</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="sonar__bebop_8c_source.html#l00047">47</a> of file <a class="el" href="sonar__bebop_8c_source.html">sonar_bebop.c</a>.</p>

<p>Referenced by <a class="el" href="sonar__bebop_8c_source.html#l00115">sonar_bebop_init()</a>, and <a class="el" href="sonar__bebop_8c_source.html#l00150">sonar_bebop_read()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_01fcd3835fb4e7d9331b722d86291b65.html">sw</a></li><li class="navelem"><a class="el" href="dir_5e9153041680afc3c016fd52fa730b56.html">airborne</a></li><li class="navelem"><a class="el" href="dir_c2abcdd6ccb39c3582929c0e3f5651c2.html">modules</a></li><li class="navelem"><a class="el" href="dir_f794e7c055cca00c0de6f5564d477f09.html">sonar</a></li><li class="navelem"><a class="el" href="sonar__bebop_8c.html">sonar_bebop.c</a></li>
    <li class="footer">Generated on Sat May 16 2020 16:06:33 for Paparazzi UAS by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.8 </li>
  </ul>
</div>
</body>
</html>
